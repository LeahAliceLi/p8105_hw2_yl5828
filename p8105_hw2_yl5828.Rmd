---
title: "p8105_hw2_yl5828"
author: "Leah Li yl5828"
date: "2025-10-01"
output: github_document
editor_options: 
  chunk_output_type: console
---


```{r message = FALSE}
# Load dataset
library(tidyverse)
library(dplyr)
library(readr)
library(lubridate)
```


## Problem 1

### Clean file pols-month

```{r read and clean pols_month}
pols_month_df =
  read_csv("./fivethirtyeight_datasets/pols-month.csv", na = c("NA", ".", "")) %>%
  janitor::clean_names() %>%
  separate(mon, into = c("year", "month", "day"), sep = "-") %>%
  mutate(
    month=recode(month, `01` ="January", `02`= "February", `03`= "March", `04`= "April", `05`= "May",`06`= "June",`07`= "July",`08`= "August",`09`= "September",`10`= "October",`11`= "November",`12`= "December"),
    president = if_else(prez_gop == 1, "gop", "dem"),
    year = as.numeric(year)
         )%>%
  select(-prez_dem, -prez_gop, -day)

pols_month_df
```

### Clean file snp

```{r read and clean snp}
snp_df =
  read_csv("./fivethirtyeight_datasets/snp.csv", na = c("NA", ".", "")) %>%
  janitor::clean_names() %>%
  separate(date, into = c("month", "day", "year"), sep = "/") %>%
  mutate(
    month=recode(month, `1` ="January", `2`= "February", `3`= "March", `4`= "April", `5`= "May",`6`= "June",`7`= "July",`8`= "August",`9`= "September",`10`= "October",`11`= "November",`12`= "December"),
    year = if_else(year > 25, 1900 + as.numeric(year), 2000 + as.numeric(year)))%>%
  select(year, month, close)

snp_df
```

### Clean file unemployment

```{r read and clean unemployment}
unemployment_df = 
  read_csv("./fivethirtyeight_datasets/unemployment.csv", na = c("NA", ".", "")) %>%
  janitor::clean_names() %>%
  pivot_longer(
    jan:dec,
    names_to = "month", 
    values_to = "unemployment") %>%
  mutate(
    month=recode(month, `jan` ="January", `feb`= "February", `mar`= "March", `apr`= "April", `may`= "May",`jun`= "June",`jul`= "July",`aug`= "August",`sep`= "September",`oct`= "October",`nov`= "November",`dec`= "December" ))

unemployment_df
```

### Join datasets

```{r Join datasets}
q1join_df = 
  inner_join(pols_month_df, snp_df, by = c("year", "month")) %>%
  inner_join(unemployment_df, by = c("year", "month"))

q1join_df
```

### Dataset Explanation

The dataset `pols_month_df` include variables as follows: `r paste(names(pols_month_df), collapse = ", ")`. And the dataset has **`r nrow(pols_month_df) `** rows and **`r ncol (pols_month_df)`** columns. 

The dataset `snp_df` include variables as follows: `r paste(names(snp_df), collapse = ", ")`. And the dataset has **`r nrow(snp_df) `** rows and **`r ncol (snp_df)`** columns. 

The dataset `unemployment_df` include variables as follows: `r paste(names(unemployment_df), collapse = ", ")`. And the dataset has **`r nrow(unemployment_df) `** rows and **`r ncol (unemployment_df)`** columns. 

The resulting dataset `q1join_df` include variables as follows: `r paste(names(q1join_df), collapse = ", ")`. And the dataset has **`r nrow(q1join_df) `** rows and **`r ncol (q1join_df)`** columns. The range of years is (**`r range(q1join_df$year)`**).



## Problem 2

### Clean dataset Mr.Trash Wheel

```{r read and clean Mr.Trash Wheel}
mr.trash_df = 
  readxl::read_excel("./Mr.Trash Wheel/202509 Trash Wheel Collection Data.xlsx", sheet="Mr. Trash Wheel", range="A2:M709", na = c("NA", ".", ""))%>%
  janitor::clean_names() %>%
  drop_na() %>%
  mutate(
    sports_balls = as.integer(round(sports_balls)),
    year = as.numeric(year),
    wheel_name = "Mr.Trash"
  )

mr.trash_df
```

### Clean dataset Professor Trash Wheel

```{r read and clean Professor Trash Wheel}
professor_trash_df = 
  readxl::read_excel("./Mr.Trash Wheel/202509 Trash Wheel Collection Data.xlsx", sheet="Professor Trash Wheel", range="A2:M134", na = c("NA", ".", ""))%>%
  janitor::clean_names() %>%
  drop_na()%>%
  mutate(wheel_name = "Professor")

professor_trash_df
```

### Clean dataset Gwynnda Trash Wheel

```{r read and clean Gwynnda Trash Wheel}
gwynnda_trash_df = 
  readxl::read_excel("./Mr.Trash Wheel/202509 Trash Wheel Collection Data.xlsx", sheet="Gwynns Falls Trash Wheel", range="A2:L351", na = c("NA", ".", ""))%>%
  janitor::clean_names() %>%
  drop_na()%>%
  mutate(wheel_name = "Gwynnda")

gwynnda_trash_df
```

### Join the three wheels together

```{r}
all_wheels_combined <- bind_rows(mr.trash_df, professor_trash_df, gwynnda_trash_df)

all_wheels_combined
```

### Dataset Explanation

```{r Professor Trash Wheel Total Weight}
prof_weight <- all_wheels_combined %>%
  filter(wheel_name == "Professor") %>%
  summarise(total_weight = sum(weight_tons, na.rm = TRUE)) %>%
  pull(total_weight)

print(prof_weight)
```

The total weight of trash collected by Professor Trash Wheel was **`r round(prof_weight, 2)`** tons.

```{r Gwynnda Trash Wheel Cigarette Butts}
gwynnda_butts <- all_wheels_combined %>%
  filter(wheel_name == "Gwynnda", month == "June", year == 2022) %>%
  summarise(total_butts = sum(cigarette_butts, na.rm = TRUE)) %>%
  pull(total_butts)

print(gwynnda_butts)
```

The total number of cigarette butts collected by Gwynnda in June of 2022 was **`r format(gwynnda_butts, big.mark = ",")`**. However, we could notice that this 0 is from the new merged datasheet. If we are using the original Gwynnda dataset, the number of cigarette butts will not be 0, the actual number would be 18120. 

The dataset contains **`r nrow(all_wheels_combined)`** observations of trash collection events for `r n_distinct(all_wheels_combined$wheel_name)` different trash wheels, spanning from `r min(all_wheels_combined$year)` to `r max(all_wheels_combined$year)`. Each observation records the contents of a single dumpster, identified by the name of the trash wheel (e.g., 'Mr. Trash Wheel', 'Gwynnda'). The dataset `mr.trash_df` include **`r nrow(mr.trash_df) `** dumpsters. The dataset `professor_trash_df` include **`r nrow(professor_trash_df) `** dumpsters. The dataset `gwynnda_trash_df` include **`r nrow(gwynnda_trash_df) `** dumpsters. The combined dataset has the following variables: **`r paste(names(all_wheels_combined), collapse = ", ")`**. Key variables include the total weight_tons for each haul, as well as counts of specific items like plastic_bottles, polystyrene, and cigarette_butts.


## Problem 3

### Read in dataset Zip_codes and ZORI

```{r Read in zip_codes and zori}
zip_codes <- read_csv("./zillow_data/Zip Codes.csv")
zori <- read_csv("./zillow_data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv")
```

### Clean dataset Zip_codes

```{r Clean zip_codes}
zip_codes_clean <- zip_codes %>%
  janitor::clean_names() %>%
  select(zip_code, county, neighborhood) %>%
  distinct()
```

### Clean dataset ZORI

```{r Clean ZORI}
zori_clean <- zori %>%
  rename(zip = RegionName)%>%
  pivot_longer(
    cols = !RegionID:CountyName,  
    names_to = "date",
    values_to = "zori"
  ) %>%
  mutate(
    date = ymd(date),
    zip = as.integer(zip)) %>%
  select(zip, CountyName, date, zori)
```

### Merge Zip_codes with ZORI.

```{r Merge zori_clean and zip_codes_clean}
zori_merged <- zori_clean |>
  left_join(zip_codes_clean, by = c("zip" = "zip_code")) %>%
  select(date,zip,CountyName,neighborhood,zori)
```

### Briefly describe the resulting zori_merged dataset.

The resulting _tidy_ dataset **`zori_merged`** contains **`r nrow(zori_merged)`** total observations. The dataset includes **`r n_distinct(zori_merged$zip)`** unique ZIP codes and **`r n_distinct(na.omit(zori_merged$neighborhood))`** unique neighborhoods across the five boroughs of New York City.

There are some ZIP codes apeear in the ZIP code dataset but not in the Zillow Rental Price dataset, such as,  **`r paste(head(setdiff(zip_codes_clean$zip_code, zori_clean$zip), 5), collapse = ", ")`**.  

These ZIP codes are often excluded because they may correspond to invalid information. For example, the ZIP codes are in fact **non-residential areas** (large commercial or industrial zones) or **P.O. boxes** numbers.  



### Rental Price Fluctuation

```{r }
covid_drop <- zori_merged |>
  filter(date %in% c("2020-01-31", "2021-01-31")) |>
  pivot_wider(names_from = date, values_from = zori) |>
  mutate(drop = `2021-01-31` - `2020-01-31`) |>
  arrange(drop) |>
  slice_head(n = 10) |>
  select(zip, county, neighborhood, `2020-01-31`, `2021-01-31`, drop)
```


Rental prices fluctuated dramatically during the COVID-19 pandemic.  
Comparing January 2021 to January 2020 across all ZIP codes, the table below shows the ten ZIP codes with the largest decline in rent prices:  

```{r echo=FALSE}
covid_drop |> knitr::kable(digits = 1, caption = "Top 10 NYC ZIP codes with largest rental price drop from Jan 2020 to Jan 2021")
```

### Comments on the TOP 10 rental prices drop ZIP code
The largest decline was in ZIP 10007 (Lower Manhattan), with a drop of about $913, from $6334 to $5422. 
Other steep declines (–$700 to –$750) occurred in 10069 (Upper West Side / Riverside area), 10009 (Lower East Side), and 10016 (Gramercy / Murray Hill).
The smallest of the “top 10” was 10010 (Gramercy / Murray Hill) with a drop of about $684.
All 10 ZIP codes are in Manhattan, indicating that this borough was most heavily affected.
Neighborhoods like Lower Manhattan, Lower East Side, Gramercy, Chelsea, Greenwich Village, and SoHo dominate the list.
These areas are usually dense, expensive rental markets with heavy reliance on office workers, students, and international residents.

During the COVID-19 pandemic (2020–2021), remote work and out-migration reduced demand for Manhattan rentals, leading to dramatic price declines.
Outer-borough neighborhoods (e.g., Queens, Bronx, Staten Island) are absent from the top 10, suggesting less dramatic fluctuations there.

ZIP 10069 has missing neighborhood info, but is known to cover part of the Upper West Side / Riverside South, an upscale area also impacted by decreased demand.

